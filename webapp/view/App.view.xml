<mvc:View xmlns:mvc="sap.ui.core.mvc" xmlns:core="sap.ui.core" xmlns="sap.m" xmlns:f="sap.f"
	controllerName="sap.ui.demo.todo.controller.App" displayBlock="true">
	<App>
		<Page>
			<!--  Icon, "todos" -->
			<customHeader>
				<f:ShellBar core:require="{ Helper: 'sap/ui/demo/todo/util/Helper' }"
					title="{i18n>TITLE}" homeIcon="{:= Helper.resolvePath('./img/logo_ui5.png') }" />
			</customHeader>

			<content>
				<f:DynamicPage>
					<f:header>
						<f:DynamicPageHeader pinnable="false">
							<FlexBox renderType="Div" alignItems="Center" justifyContent="Start">
								<!-- Not Working :( -->
								<FlexBox >
									<Select class="todoPriority" id="addTodoItemPriority" 
										forceSelection="false"
										selectedKey="{/newTodo/priority}"
										items="{ 
											path: 'view>/selectOptions/OptionCollection',
											sorter: { path: 'PriorityID',
														descending: true } 
										}">
										<core:ListItem key="{view>PriorityID}" text="{view>PriName}" icon="{view>Icon}"
										class="sapUiSmallMarginEnd"/>
									</Select>
								</FlexBox>
								<FlexBox justifyContent="Center" alignItems='Center'>
									<Label text=" DDL: " textAlign="Center" class="sapUiSmallMarginEnd"/>
									<DatePicker id='DP1'
										value="{
											path:'/newTodo/DDLAtUTC',
											type: 'sap.ui.model.type.Date',
											formatOptions:{
												source: { pattern: 'yyyy-MM-dd\'T\'HH:mm:ss.sss\'Z' }
											}
									}" 
									class="sapUiSmallMarginEnd"/>
								</FlexBox>
								
							</FlexBox>
							<!--  Input: ("What needs to be done?") -->
							<Input class="todoInput" id="addTodoItemInput" value="{/newTodo/title}"
								placeholder="{i18n>INPUT_PLACEHOLDER}"/>
							<Button id="addTodoItemButton"
								icon="sap-icon://add-product" text="{i18n>ADD_NEW_TODO_BUTT}"
								enabled="{= ${/newTodo/title} !== '' }"
								press=".addTodo"/>
								<!--  -->
						</f:DynamicPageHeader>
					</f:header>

					<f:content>
						<List 
							id="todoList"
							headerText="{i18n>todoListTitle}"
							noDataText="{i18n>NO_ITEMS}"
							items="{
								path: '/todos', events: { change: '.updateItemsLeftCount' } ,
								sorter: {
									path: 'addedAtUTC',
									descending:false,
									group:false
									}
								}"
							mode="None"
							growing="true"
							growingScrollToLoad="true"
							showNoData="false"
							showSeparators="None">

							<!-- 功能栏 -->
							<headerToolbar>
								<OverflowToolbar id="toolbar" class="sapUiSizeCompact"
									visible="{= !${view>/isMobile} }">
									<Title text="{i18n>todoListTitle}"/>
									<!-- Sorting and Grouping -->
									<Label text="sorted by: "/>
									<Select id="groupingOpt" class="sapUiSizeCompact" 
									forceSelection="false"
									selectedKey="{view>/ogpOptions/grpOption}"
									items="{ 
										path: 'view>/ogpOptions/groupingOptions',
										sorter: { path: 'groupingID',
													descending: false } 
									}"
									change=".changeSortingOption">
									<core:ListItem key="{view>groupingID}" text="{view>groupingName}" icon="{view>Icon}"
										class="sapUiSmallMarginEnd"/>
									<!-- End of Sorting and Grouping -->
									</Select>
									<ToolbarSpacer/>
									<SearchField id="searchTodoItemsInput" liveChange=".onSearch"
										width="20rem" />
									<SegmentedButton selectedKey="all" selectionChange=".onFilter"
										class="sapMSegmentedButtonNoAutoWidth">
										<items>
											<SegmentedButtonItem text="{i18n>LABEL_ALL}" key="all" />
											<SegmentedButtonItem text="{i18n>LABEL_ACTIVE}" key="active" />
											<SegmentedButtonItem text="{i18n>LABEL_COMPLETED}" key="completed" />
										</items>
									</SegmentedButton>

									<Button id="clearHashTagFilter" enabled="true"
										icon="sap-icon://action" text="{i18n>CLEAR_HASHTAG_FILTER}"
										press=".clearHashTagFilter" >
									</Button>

									<Button id="clearCompleted" enabled="{/itemsRemovable}"
										icon="sap-icon://delete" text="{i18n>CLEAR_COMPLETED}"
										press=".clearCompleted">
										<layoutData>
											<OverflowToolbarLayoutData priority="AlwaysOverflow"/>
										</layoutData>
									</Button>

								</OverflowToolbar>
							</headerToolbar>
							
							<!-- 内容栏（表格） -->
							<infoToolbar>
								<OverflowToolbar
									visible="{= !!${view>/filterText} }"
									active="false">
									<Label text="{view>/filterText}" />
								</OverflowToolbar>
							</infoToolbar>

							<CustomListItem>
								<HBox>
									<CheckBox
										selected="{completed}"
										select="onCompletedClick"/>
									<!-- Priority -->
									<FlexBox justifyContent="Center"
										alignItems='Center'
										class="CustomListItemPriority"
									>
										<Text
											text="{
												path:'priority',
												formatter: '.formatter.priorityText'
											}"
											textAlign="Center"
											width="74px">
											<customData>
												<core:CustomData key="todo-item-priority"
													value="{priority}" writeToDom="true" />
											</customData>
										</Text>
									</FlexBox>
									<VBox justifyContent="Center"
										class="CustomListItemTitle"
										width="60%">
										<Text text="{title}">
											<customData>
												<core:CustomData key="todo-item-completed"
													value="{= String(${completed})}" writeToDom="true" />
											</customData>
										</Text>
										<Link
											text="{hashTag}"
											press="pressOnHashTag"/>
									</VBox>
									<VBox justifyContent="Center" width="auto">
										<FlexBox alignItems='Center'>
											<Label text="Added at: "/>
											<Text text="{
												path: 'addedAtUTC'
											} " />
										</FlexBox>
										<FlexBox alignItems='Center'>
											<Label text="DDL: "/>
											<Text text="{
												path: 'DDLAtUTC'
											} ">
												<customData>
													<core:CustomData key="todo-item-overtime"
														value="{= String(${view>/timeNow} > ${DDLAtUTC}) }" writeToDom="true" />
												</customData>
											</Text>
										</FlexBox>
									</VBox>
								</HBox>
							</CustomListItem>
						</List>
					</f:content>
				</f:DynamicPage>
			</content>

			<footer>
				<OverflowToolbar id="toolbar-footer" visible="{= !!${view>/isMobile} }">
					<SegmentedButton selectedKey="all" selectionChange=".onFilter"
						class="sapMSegmentedButtonNoAutoWidth">
						<items>
							<SegmentedButtonItem text="All" key="all" />
							<SegmentedButtonItem text="Active" key="active" />
							<SegmentedButtonItem text="Completed" key="completed" />
						</items>
					</SegmentedButton>
					<ToolbarSpacer />
					<Button id="clearCompleted-footer" enabled="{/itemsRemovable}"
						icon="sap-icon://delete" text="{i18n>CLEAR_COMPLETED}"
						press=".clearCompleted" />
				</OverflowToolbar>
			</footer>

		</Page>
	</App>
</mvc:View>